(()=>{"use strict";var e={295:(e,t,n)=>{function s(e){return s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},s(e)}Object.defineProperty(t,"__esModule",{value:!0}),t.Collapse=void 0;var r,o=(r=n(196))&&r.__esModule?r:{default:r};function i(e,t){for(var n=0;n<t.length;n++){var s=t[n];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}function a(e,t){return a=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},a(e,t)}function l(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function c(e){return c=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},c(e)}function u(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var p=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&a(e,t)}(h,e);var t,n,r,p,d=(r=h,p=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=c(r);if(p){var n=c(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return function(e,t){if(t&&("object"===s(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return l(e)}(this,e)});function h(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,h),u(l(t=d.call(this,e)),"timeout",void 0),u(l(t),"container",void 0),u(l(t),"content",void 0),u(l(t),"onResize",(function(){if(clearTimeout(t.timeout),t.container&&t.content){var e=t.props,n=e.isOpened,s=e.checkTimeout,r=Math.floor(t.container.clientHeight),o=Math.floor(t.content.clientHeight),i=n&&Math.abs(o-r)<=1,a=!n&&Math.abs(r)<=1;i||a?t.onRest({isFullyOpened:i,isFullyClosed:a,isOpened:n,containerHeight:r,contentHeight:o}):(t.onWork({isFullyOpened:i,isFullyClosed:a,isOpened:n,containerHeight:r,contentHeight:o}),t.timeout=setTimeout((function(){return t.onResize()}),s))}})),u(l(t),"onRest",(function(e){var n=e.isFullyOpened,s=e.isFullyClosed,r=e.isOpened,o=e.containerHeight,i=e.contentHeight;if(t.container&&t.content){var a=r&&t.container.style.height==="".concat(i,"px"),l=!r&&"0px"===t.container.style.height;if(a||l){t.container.style.overflow=r?"initial":"hidden",t.container.style.height=r?"auto":"0px";var c=t.props.onRest;c&&c({isFullyOpened:n,isFullyClosed:s,isOpened:r,containerHeight:o,contentHeight:i})}}})),u(l(t),"onWork",(function(e){var n=e.isFullyOpened,s=e.isFullyClosed,r=e.isOpened,o=e.containerHeight,i=e.contentHeight;if(t.container&&t.content){var a=r&&t.container.style.height==="".concat(i,"px"),l=!r&&"0px"===t.container.style.height;if(!a&&!l){t.container.style.overflow="hidden",t.container.style.height=r?"".concat(i,"px"):"0px";var c=t.props.onWork;c&&c({isFullyOpened:n,isFullyClosed:s,isOpened:r,containerHeight:o,contentHeight:i})}}})),u(l(t),"onRefContainer",(function(e){t.container=e})),u(l(t),"onRefContent",(function(e){t.content=e})),e.initialStyle?t.initialStyle=e.initialStyle:t.initialStyle=e.isOpened?{height:"auto",overflow:"initial"}:{height:"0px",overflow:"hidden"},t}return t=h,(n=[{key:"componentDidMount",value:function(){this.onResize()}},{key:"shouldComponentUpdate",value:function(e){var t=this.props,n=t.theme,s=t.isOpened;return t.children!==e.children||s!==e.isOpened||Object.keys(n).some((function(t){return n[t]!==e.theme[t]}))}},{key:"getSnapshotBeforeUpdate",value:function(){if(!this.container||!this.content)return null;if("auto"===this.container.style.height){var e=this.content.clientHeight;this.container.style.height="".concat(e,"px")}return null}},{key:"componentDidUpdate",value:function(){this.onResize()}},{key:"componentWillUnmount",value:function(){clearTimeout(this.timeout)}},{key:"render",value:function(){var e=this.props,t=e.theme,n=e.children,s=e.isOpened;return o.default.createElement("div",{ref:this.onRefContainer,className:t.collapse,style:this.initialStyle,"aria-hidden":!s},o.default.createElement("div",{ref:this.onRefContent,className:t.content},n))}}])&&i(t.prototype,n),h}(o.default.Component);t.Collapse=p,u(p,"defaultProps",{theme:{collapse:"ReactCollapse--collapse",content:"ReactCollapse--content"},initialStyle:void 0,onRest:void 0,onWork:void 0,checkTimeout:50})},619:(e,t,n)=>{function s(e){return s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},s(e)}Object.defineProperty(t,"__esModule",{value:!0}),t.UnmountClosed=void 0;var r,o=(r=n(196))&&r.__esModule?r:{default:r},i=n(295),a=["isOpened"],l=["isOpened"];function c(){return c=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var s in n)Object.prototype.hasOwnProperty.call(n,s)&&(e[s]=n[s])}return e},c.apply(this,arguments)}function u(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,s)}return n}function p(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?u(Object(n),!0).forEach((function(t){b(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):u(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function d(e,t){if(null==e)return{};var n,s,r=function(e,t){if(null==e)return{};var n,s,r={},o=Object.keys(e);for(s=0;s<o.length;s++)n=o[s],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(s=0;s<o.length;s++)n=o[s],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}function h(e,t){for(var n=0;n<t.length;n++){var s=t[n];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}function f(e,t){return f=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},f(e,t)}function y(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function m(e){return m=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},m(e)}function b(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var v=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&f(e,t)}(g,e);var t,n,r,u,v=(r=g,u=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=m(r);if(u){var n=m(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return function(e,t){if(t&&("object"===s(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return y(e)}(this,e)});function g(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,g),b(y(t=v.call(this,e)),"onWork",(function(e){var n=e.isOpened,s=d(e,a);t.setState({isResting:!1,isOpened:n});var r=t.props.onWork;r&&r(p({isOpened:n},s))})),b(y(t),"onRest",(function(e){var n=e.isOpened,s=d(e,l);t.setState({isResting:!0,isOpened:n,isInitialRender:!1});var r=t.props.onRest;r&&r(p({isOpened:n},s))})),b(y(t),"getInitialStyle",(function(){var e=t.state,n=e.isOpened;return e.isInitialRender&&n?{height:"auto",overflow:"initial"}:{height:"0px",overflow:"hidden"}})),t.state={isResting:!0,isOpened:e.isOpened,isInitialRender:!0},t}return t=g,(n=[{key:"componentDidUpdate",value:function(e){var t=this.props.isOpened;e.isOpened!==t&&this.setState({isResting:!1,isOpened:t,isInitialRender:!1})}},{key:"render",value:function(){var e=this.state,t=e.isResting,n=e.isOpened;return t&&!n?null:o.default.createElement(i.Collapse,c({},this.props,{initialStyle:this.getInitialStyle(),onWork:this.onWork,onRest:this.onRest}))}}])&&h(t.prototype,n),g}(o.default.PureComponent);t.UnmountClosed=v,b(v,"defaultProps",{onWork:void 0,onRest:void 0})},180:(e,t,n)=>{var s=n(295).Collapse,r=n(619).UnmountClosed;e.exports=r,r.Collapse=s,r.UnmountClosed=r},251:(e,t,n)=>{var s=n(196),r=Symbol.for("react.element"),o=Symbol.for("react.fragment"),i=Object.prototype.hasOwnProperty,a=s.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,l={key:!0,ref:!0,__self:!0,__source:!0};function c(e,t,n){var s,o={},c=null,u=null;for(s in void 0!==n&&(c=""+n),void 0!==t.key&&(c=""+t.key),void 0!==t.ref&&(u=t.ref),t)i.call(t,s)&&!l.hasOwnProperty(s)&&(o[s]=t[s]);if(e&&e.defaultProps)for(s in t=e.defaultProps)void 0===o[s]&&(o[s]=t[s]);return{$$typeof:r,type:e,key:c,ref:u,props:o,_owner:a.current}}t.Fragment=o,t.jsx=c,t.jsxs=c},893:(e,t,n)=>{e.exports=n(251)},196:e=>{e.exports=window.React}},t={};function n(s){var r=t[s];if(void 0!==r)return r.exports;var o=t[s]={exports:{}};return e[s](o,o.exports,n),o.exports}n.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return n.d(t,{a:t}),t},n.d=(e,t)=>{for(var s in t)n.o(t,s)&&!n.o(e,s)&&Object.defineProperty(e,s,{enumerable:!0,get:t[s]})},n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t);var s={};(()=>{n.d(s,{J:()=>O});const e=window.wc.wcBlocksRegistry,t=window.wp.htmlEntities,r=window.wc.wcSettings;var o=n(196),i=n.n(o),a=n(180);class l{static messages={};static setMessages(e){l.messages=e}static getMessage(e,t=""){return void 0===l.messages[e]?t:l.messages[e]}}var c=n(893);class u extends i().Component{constructor(e){super(e),this.state={...this.state,blikCode:"",blikError:""}}render(){return(0,c.jsxs)(c.Fragment,{children:[(0,c.jsx)("input",{type:"text",inputMode:"numeric",value:this.state.blikCode,onChange:this.handleBlikCodeChange,onFocus:this.handleOnFocus,placeholder:l.getMessage("enter_the_blik_code","Payment failed"),maxLength:6,className:"blik-input",pattern:"\\d{6}"}),(0,c.jsx)("span",{className:"atp-block-payment-description",children:l.getMessage("the_code_has_6_digits_note","The code has 6 digits. You'll find it in your banking app.")}),this.state.blikError&&(0,c.jsx)("span",{className:"atp-block-payment-description blik-error",children:this.state.blikError})]})}handleBlikCodeChange=e=>{const t=e.target.value;if(!/^\d*$/.test(t))return;const n=/^\d{6}$/.test(t);this.setState({blikCode:t,blikError:n?"":l.getMessage("code_is_invalid_code_should_be_6_digits","The code you provided is invalid. Code should be 6 digits.")}),n&&this.props.onBlikCodeChange(t)};handleOnFocus=e=>{this.props.onFocus()}}class p{static distillHtmlClassByString(e){return e.toLowerCase().trim().replace(/[\s_-]+/g,"_").replace(/^-+|-+$/g,"").normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/[^a-z0-9_]/g,"")}}class d extends i().Component{hasParent=!1;static instances=[];isBlik0=!1;blikCode="";constructor(e){super(e),this.state={isOpen:!1,isSelected:!1},this.hasParent=!!e.hasParent&&e.hasParent,d.instances.push(this)}render(){const{numericChannelId:e,id:t,value:n,name:s,label:r,icon:o,description:i,items:l,hasParent:d,data:f}=this.props;this.numericChannelId=e;const y=Array.isArray(l)&&l.length>0,m=509===e&&f&&"object"==typeof f&&"blik0"in f&&!0===f.blik0;return this.isBlik0=m,(0,c.jsxs)("li",{className:`atp-${p.distillHtmlClassByString(r)} atp-block-payment-item ${y&&"atp-has-children"}`,children:[(0,c.jsxs)("label",{className:this.state.isSelected?"atp-active":"",htmlFor:t,children:[(0,c.jsx)("input",{onClick:this.hasParent?this.handleToggleSelected:y?this.handleToggle:this.closeAllInstances,id:t,value:n,type:"radio",name:s}),(0,c.jsx)("img",{src:o,alt:s}),(0,c.jsxs)("div",{className:"atp-block-payment-item-wrapper",children:[m?(0,c.jsx)(u,{placeholder:"******",paymentChannel:this,onBlikCodeChange:this.handleBlikCodeChange,onFocus:this.handleToggleSelected}):(0,c.jsx)("span",{className:"atp-block-payment-label",children:r}),(0,c.jsx)("span",{className:"atp-block-payment-description",dangerouslySetInnerHTML:{__html:i}})]})]}),(0,c.jsx)(a.Collapse,{isOpened:this.state.isOpen,children:y?(0,c.jsx)(h,{items:l,hasParent:!0}):null})]})}handleBlikCodeChange=e=>{this.blikCode=e,this.handleToggleSelected()};handleToggle=()=>{this.handleToggleSelected(),this.setState({isOpen:!this.state.isOpen,isSelected:this.state.isSelected})};handleToggleSelected=()=>{this.unselectAllInstances(),this.setState({isOpen:this.state.isOpen,isSelected:!0}),O.setPaymentChannelId(this.numericChannelId),O.setIsBlik0(this.isBlik0),O.setBlikCode(this.blikCode)};closeAllInstances=()=>{d.instances.forEach((e=>{e.setState({isOpen:!1,isSelected:!1})})),this.handleToggleSelected()};unselectAllInstances(){d.instances.forEach((e=>{e.setState({isOpen:e.state.isOpen,isSelected:!1})}))}}class h extends i().Component{hasParent=!1;constructor(e){super(e),this.list=e.items,this.hasParent=!!e.hasParent&&e.hasParent}render(){if(this.list&&0!==this.list.length)return(0,c.jsx)("ul",{className:"atp-block-payment",children:this.list.map((e=>(0,c.jsx)(d,{numericChannelId:e.numericChannelId,id:e.key,value:e.value,name:e.name,label:e.label,icon:e.icon,items:e.items,description:e.description,data:e.data,hasParent:this.hasParent})))})}}class f extends i().Component{constructor(e){super(e)}render(){const{label:e,iconSrc:t,iconAlt:n}=this.props;return(0,c.jsxs)(c.Fragment,{children:[(0,c.jsx)("span",{className:"wc-block-components-payment-method-label",children:e}),(0,c.jsx)("img",{src:t,alt:n})]})}}class y{static APPLE_PAY_CHANNEL_ID=1513;static processItem({key:e,value:t,name:n,label:s,icon:r,id:o,block_description:i,items:a,data:l}){let c={numericChannelId:o=parseInt(o),key:e,value:t,name:n,label:s,icon:r,description:i,items:[],data:l};if(a&&a.length>0)for(const e of a)c.items.push(y.processItem(e));return c}static createChannelsFromServer(e){let t={items:[]};for(const n of e){let e=y.processItem(n);this.validateItem(e)&&t.items.push(e)}return t}static validateItem(e){return!(e.numericChannelId===this.APPLE_PAY_CHANNEL_ID&&!this.isApplePay())}static isApplePay(){return window.ApplePaySession}}class m{static create({title:e,description:t,icon_src:n,whitelabel:s,supports:r,place_order_button_label:o,channels:i,messages:a,adminAjaxUrl:l,nonce:c}){try{return{label:e,description:t,iconSrc:n,whitelabel:s,placeOrderButtonLabel:o,supports:r,channels:y.createChannelsFromServer(i),messages:a,adminAjaxUrl:l,nonce:c}}catch(e){throw e("Create PaymentMethodData failed")}}}let b=function(e){return e.STATUS_SUCCESS="payment_success",e.STATUS_ERROR="error",e.STATUS_CHECK_DEVICE="check_device",e.STATUS_WAIT="wait",e}({});class v extends i().Component{constructor(e){super(e),this.state={message:"",status:b.STATUS_WAIT,visible:!1}}show(e,t){this.setState({message:e,status:t,visible:!0}),document.body.style.overflow="hidden"}hide(){this.setState({message:"",status:b.STATUS_WAIT,visible:!1}),document.body.style.overflow="auto"}render(){return this.state.visible?(0,c.jsx)("div",{className:"bm-blik-overlay",children:(0,c.jsx)("div",{className:"bm-blik-overlay-content",onClick:e=>e.stopPropagation(),children:(0,c.jsx)("p",{children:(0,c.jsx)("span",{className:`bm-blik-overlay-status ${this.state.status}`,children:this.state.message})})})}):null}}const g=(0,r.getPaymentMethodData)("bluemedia",{});class O extends i().Component{payment_data=["test"];constructor(){super({}),this.blikOverlayRef=i().createRef()}static init(t){O.paymentMethodDataFromServer=m.create(g),l.setMessages(O.paymentMethodDataFromServer.messages),(0,e.registerPaymentMethod)({name:"bluemedia",label:(0,c.jsx)(f,{label:this.paymentMethodDataFromServer.label,iconSrc:this.paymentMethodDataFromServer.iconSrc,iconAlt:this.paymentMethodDataFromServer.label}),content:(0,c.jsx)(O,{}),edit:(0,c.jsx)(O,{}),ariaLabel:this.paymentMethodDataFromServer.label,supports:{features:this.paymentMethodDataFromServer.supports},canMakePayment:()=>!0,placeOrderButtonLabel:this.paymentMethodDataFromServer.placeOrderButtonLabel,savedTokenComponent:(0,c.jsx)(O,{})})}static setPaymentChannelId(e){O.paymentChannelId=e}static setIsBlik0(e){O.isBlik0=e}static setBlikCode(e){O.blikCode=e}showBlikOverlay(e,t){this.blikOverlayRef.current&&this.blikOverlayRef.current.show(e,t)}hideBlikOverlay(){this.blikOverlayRef.current&&this.blikOverlayRef.current.hide()}render(){return O.paymentMethodDataFromServer.whitelabel?(0,c.jsxs)(c.Fragment,{children:[(0,c.jsx)(v,{ref:this.blikOverlayRef})," ",(0,c.jsx)(h,{items:O.paymentMethodDataFromServer.channels.items})]}):(0,c.jsx)(c.Fragment,{children:(0,t.decodeEntities)(O.paymentMethodDataFromServer.description||"")})}componentDidMount(){const{eventRegistration:e,emitResponse:t}=this.props,{onPaymentProcessing:n,onCheckoutSuccess:s}=e;this.unsubscribe=n((async()=>{if(O.paymentMethodDataFromServer.whitelabel){const e=O.paymentChannelId;if(e){const n=O.isBlik0,s=O.blikCode;return n?{type:t.responseTypes.SUCCESS,meta:{paymentMethodData:{autopay_numeric_channel_Id:e.toString(),bluemedia_blik_code:s,blik_0_block_payment:"1"}}}:{type:t.responseTypes.SUCCESS,meta:{paymentMethodData:{autopay_numeric_channel_Id:e.toString()}}}}return{type:t.responseTypes.ERROR,message:l.getMessage("no_payment_channel_selected","No payment channel selected.")}}})),this.unsubscribeCheckoutSuccess=s((async()=>{const e=O.paymentChannelId,n=O.isBlik0;if(e&&n)try{const e=await this.performAjaxRequests();return this.showBlikOverlay(e.message,e.status),await new Promise((e=>setTimeout(e,3e3))),this.hideBlikOverlay(),{type:t.responseTypes.SUCCESS}}catch(e){return this.showBlikOverlay(l.getMessage("payment_failed","Payment failed"),b.STATUS_ERROR),await new Promise((e=>setTimeout(e,3e3))),{type:t.responseTypes.SUCCESS}}}))}unsubscribe=null;unsubscribeCheckoutSuccess=null;async performAjaxRequests(){console.log(O.paymentMethodDataFromServer);const e=O.paymentMethodDataFromServer.adminAjaxUrl,t=O.paymentMethodDataFromServer.nonce,n=Date.now(),s=async()=>{if(Date.now()-n>12e4)throw new Error("Operation timed out after 2 minutes.");const r=new FormData;r.append("action","bm_payment_get_status_action"),r.append("nonce",t);const o=await fetch(e,{method:"POST",body:r});if(!o.ok)throw new Error("Request failed");const i=await o.json();return console.log(o),i.status===b.STATUS_SUCCESS?i:i.status===b.STATUS_CHECK_DEVICE||i.status===b.STATUS_WAIT?(this.showBlikOverlay(i.message,i.status),await new Promise((e=>setTimeout(e,3e3))),s()):i()};return await s()}componentWillUnmount(){this.unsubscribe&&this.unsubscribe()}}O.init(g)})()})();